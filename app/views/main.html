<!DOCTYPE html>

<html>
    <head>
        <title>Petals.ESB - #{get 'title' /}</title>
        <meta charset="utf-8">
		<link rel="stylesheet" href="@{'/public/assets/css/bootstrap.css'}">
		<style type="text/css">
		body {
			padding-top: 60px;
			padding-bottom: 40px;
		}
		
		.sidebar-nav {
			padding: 9px 0;
		}
		</style>
		<link href="@{'/public/assets/css/bootstrap-responsive.css'}" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="@{'/public/assets/gritter/css/jquery.gritter.css'}" />
		
        #{get 'moreStyles' /}
        
        <link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.png'}">
        #{get 'moreScripts' /}
        
    </head>
    <body>

	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="btn btn-navbar" data-toggle="collapse"
					data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</a>
				<a class="brand" href="@{Application.index()}">Petals.ESB</a>
				<div class="nav-collapse" id="main-menu">
					<ul class="nav" id="main-menu-left">
						<!-- <li><a href="">Groups</a></li> -->
						
						<li class="dropdown" id="preview-menu">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#">Artifacts <b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="@{ArtifactsController.index()}">List</a></li>
								<li><a href="@{ArtifactsController.repository()}">Repository</a></li>
							</ul>
						</li>
						<li class="dropdown" id="preview-menu">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#">Endpoints <b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="@{EndpointsController.index()}">List</a></li>
							</ul>
						</li>
                        <li class="dropdown" id="preview-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Monitoring <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="@{MonitoringController.subscriptions()}">Subscriptions</a></li>
                                <li><a href="@{MonitoringController.index()}">Alerts</a></li>
                                <li><a href="@{MonitoringController.index()}">Timeline</a></li>
                            </ul>
                        </li>
					</ul>

					<ul class="nav pull-right" id="main-menu-right">
						<li class="dropdown" id="preview-menu">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#">
							<img src="" width="20px" height="20px" />
							#{if currentnode}
							Connected to ${currentnode.host}:${currentnode.port}
							#{/if}
							#{else}
							Not connected
							#{/else}
							<b class="caret"></b></a>
							
							<ul class="dropdown-menu">
								<li><a href="@{NodesController.index()}">Select Node</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
	
	<div class="row">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Context</li>
              <li><a href="@{Application.index()}"><i class="icon-fire"></i> Activity <span class="badge badge-important" id="event-count" style="display: none">0</span></a></li>
              <li><a href="@{MonitoringController.index()}"><i class="icon-signal"></i> Alerts <span class="badge badge-important" id="alert-count" style="display: none">0</span></a></li>
              #{if currentnode}
              <li class="divider"></li>
              <li class="nav-header">Node Resources</li>
              <li><a href="@{NodesController.node(currentnode.id)}"><i class="icon-info-sign"></i> Info</a></li>
              <li><a href="@{ArtifactsController.index()}"><i class="icon-tag"></i> Artifacts <span class="badge badge-info">0</span></a></li>
              <li><a href="@{EndpointsController.index()}"><i class="icon-tags"></i> Endpoints <span class="badge badge-info">0</span></a></li>
              <li><a href="#"><i class="icon-globe"></i> Topology</a></li>
			  <li class="divider"></li>
              <li><a href="@{NodesController.disconnect()}"><i class="icon-off"></i> Disconnect</a></li>
			  #{/if}
			  #{else}
			  <li class="divider"></li>
              <li><a href="@{NodesController.index()}"><i class="icon-off"></i> Connect</a></li>
			  #{/else}
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span9">    
	
		#{if flash.success}
		<div class="alert alert-success">
			<button type="button" class="close" data-dismiss="alert">×</button>
			<strong>${flash.success}</strong>
		</div>
		#{/if}
		
		#{if flash.error}
		<div class="alert alert-error">
			<button type="button" class="close" data-dismiss="alert">×</button>
			<strong>${flash.error}</strong>
		</div>
		#{/if}
		
		#{ifErrors}
	    <div class="alert alert-error">
			<button type="button" class="close" data-dismiss="alert">×</button>
	       	<p><strong>Some values are invalid, please fix them...</strong></p>
	       	<ul>
	       		#{errors}
	    		<li>${error}</li>
	  			#{/errors}
	  		</ul>
	     </div>
		#{/ifErrors}
	
		#{doLayout /}
    
    #{if playuser}
  		</div>
  	</div>
  	#{/if}
  	</div>
  	
  	<script src="@{'/public/assets/js/jquery.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-transition.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-alert.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-modal.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-dropdown.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-scrollspy.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-tab.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-tooltip.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-popover.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-button.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-collapse.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-carousel.js'}"></script>
	<script src="@{'/public/assets/js/bootstrap-typeahead.js'}"></script>
	<script type="text/javascript" src="@{'/public/assets/gritter/js/jquery.gritter.js'}"></script>

	<script src="@{'/public/assets/petals/js/application.js'}" type="text/javascript"></script>

	<script>
	   $.extend($.gritter.options, {
	     position: 'bottom-right'
	   });
	</script>
	
    #{get 'lastScripts' /}
    
        <!-- Websocket -->
    <script>
    if (window["WebSocket"]) {

        var alertConnection = new WebSocket('@@{AlertWebSocket.newAlert()}');
        alertConnection.onmessage = function(evt) {
            $.petals.newAlert(evt);
        }

        var eventConnection = new WebSocket('@@{WebSocket.newMessage()}');
        eventConnection.onmessage = function(evt) {
            $.petals.newEvent(evt)
        }


		var conn = new WebSocket('@@{WebSocket.newMessage()}');
		conn.onmessage = function(evt) {

			var d = $.parseJSON(evt.data);
			var unique_id = $.gritter.add({
			    title: d.title,
			    text: d.content,
			    sticky: false,
			    time: '2000'
			  });
		};

		conn.onclose = function(evt) {
			var unique_id = $.gritter.add({
			    title: 'Websocket status',
			    text: 'Closed!',
			    sticky: false,
			    time: '1000'
			  });
		};
	} else {
		var unique_id = $.gritter.add({
		    title: 'Websocket status',
		    text: 'Browser does not support WebSockets!',
		    sticky: false,
		    time: '1000'
		  });
	}
    </script>
    
  </body>
</html>
